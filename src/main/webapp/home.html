<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Visualization Show</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
<!--    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">-->
    <link rel="stylesheet" href="./dist/font/fontawesome-free.min.css">
    <link rel="stylesheet" href="./dist/adminlte/css/adminlte.min.css">

    <style>
        #nav-content{
          border:none;
          padding: 0;
          margin: 0;
        }
        iframe{
          position: relative;
          top:0;
          left:0;
          z-index:1;
          width: 100vw;
          height: 100vh;
          border:none;
          padding: 0;
          margin: 0;
          display: block;
        }
    </style>
</head>
<body class="hold-transition sidebar-mini sidebar-collapse layout-fixed">
<div class="wrapper">
    <nav id="nav-content" class="main-header navbar navbar-expand navbar-white navbar-light">
        <iframe id="iframe-main-content" src="tools/visualization.html" class="content-window-normal-screen"></iframe>
    </nav>


    <aside class="main-sidebar sidebar-dark-primary elevation-2">
        <a href="#" class="brand-link elevation-4">
            <img src="favicon.ico" alt="Visualization Show" class="brand-image img-circle elevation-3" style="opacity: .8">
            <span class="brand-text font-weight-light">Visualization Show</span>
        </a>

        <div class="sidebar">
            <nav class="mt-2">
                <ul id="harvest-result-list" class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                </ul>
            </nav>
        </div>

    </aside>

</div>


<script src="./dist/jquery/jquery-3.4.1.min.js"></script>
<script src="./dist/bootstrap/bootstrap.bundle.min.js"></script>
<script src="./dist/plugins/bs-custom-file-input.min.js"></script>
<script src="./dist/adminlte/js/adminlte.js"></script>
<script src="./tools/visualization.js"></script>


<script>
   function fill_aside_list(data){
      var h='';
      for(var i=0; i<data.length; i++){
          h+=gen_html_content_ti(data[i]);
      }
      $('#harvest-result-list').html(h);
   }

   function gen_html_content_ti(ti){
      var h='<li class="nav-item">';
      h+='<a href="#" class="nav-link">'
      h+='<i class="nav-icon fas fa-bullseye"></i>';
      h+='<p>';
      h=h+'TI ID: '+ti.tiId;
      h+='<i class="fas fa-angle-left right"></i>';
      h+='</p>';
      h+='</a>';
      h+='<ul class="nav nav-treeview">';

      var hrList=ti.hrList;
      for(var i=0; i<hrList.length; i++){
        h+=gen_html_content_hr(ti.tiId, hrList[i]);
      }
      h+='</ul>';
      h+='</li>';
      return h;
   }

   function gen_html_content_hr(jobId, hr){
      var h='<li class="nav-item">';
      h+='<a href="javascript: switch_url_iframe('+jobId+','+hr.hrId+','+hr.hrNumber+')" class="nav-link">';
      if(!hr.indexed){
        h+='<i class="far fa-circle nav-icon text-danger" style="font-size: 0.8em;"></i>';
      }else{
        h+='<i class="far fa-circle nav-icon" style="font-size: 0.8em;"></i>';
      }
      h=h+'<p>Harvest Result: '+hr.hrNumber+'</p>';
      if(!hr.indexed){
        h+='<span class="badge badge-info right">No Index</span>';
      }
      h+='</a>';
      h+='</li>';
      return h;
   }

   function switch_url_iframe(jobId, hrId, hrNum){
      var url='tools/visualization.html?targetInstanceOid='+jobId+'&harvestResultId='+hrId+'&harvestNumber='+hrNum;
      $('#iframe-main-content').attr('src', url);
   }

   function refresh(){
        var reqUrl="/vis/all_hr_results";
        fetchHttp(reqUrl, null, fill_aside_list);
   }
   $(function(){ refresh(); });
</script>
</body>
</html>
